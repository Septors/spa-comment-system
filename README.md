# SPA Comment System (Backend)

**Backend-частина системи коментарів** з аутентифікацією, RBAC, чергами та кешуванням.

---

##  Особливості

### **1. Ядро системи**
- **Аутентифікація**: JWT + refresh-токени.
- **RBAC**: ролі USER/GUEST, гості вимагають CAPTCHA.
- **Файли**: завантаження зображень/тексту з автоматичним ресайзом через черги.
  
### **2. Оптимізації**
- **Кешування**: Redis (LIFO-список останніх коментарів + фільтри).
- **Фонова обробка:**: BullMQ для ресайза изображений.
- **Валідація**: 
  - MIME-типи файлів.
  - XHTML-теги в коментарях (дозволені: <a>, <code>, <i>, <strong>).
    
### **3. Технології**
- **Node.js** (Express)
- **Prisma** (PostgreSQL)
- **Redis** (кеш + черги)
- **BullMQ** (черги задач))
- **JWT**  (токени безпеки)
- **multer** (отримання та фільтрація файлів)
- **sharp** (зміна розміру файлу)
- **websocket** (реактивний зв’язок клієнт-сервер) 


##  Запуск проекту

### 1. **Вимоги**
- Docker + Docker Compose
- Node.js v18+

### 2. **Інструкція**
# 1. Клонуйте репозиторій
git clone https://github.com/Septors/spa-comment-system
cd spa-comment-system

# 2. Встановіть залежності та запустіть сервер

 створіть файл .env на основі .env.example:

npm install

npm start

# 3. Запустіть сервіси через Docker Compose:
docker-compose up -d -build

# 4. Запуск APi:
- frontend: http://localhost:3000/
- для перевірки в postman: http://localhost:5000/


##  API Documentation
Повна специфікація API доступна у файлі:[swagger.yaml](./swagger.yaml)

## Важливі деталі
# Для гостей:
- Вимагається  CAPTCHA.
- Створюється тимчасовий акаунт із рандомним email, наприклад: guest_123@temp.com.


 # Для користувачів:
- Реєстрація та вхід з валідацією.
- JWT-токени з чорним списком у Redis.

# Робота з файлами
- Зображення автоматично ресайзяться при перевищенні максимальних розмірів (MAX_WIDTH/HEIGHT).

- Тексти перевіряються на XSS та підтримують валідні теги.

- Frontend (демо)
Мінімальний інтерфейс для тестування API:
- Створення користувача
- Створення коментаря.
- Попередній перегляд файлу при виборі під час створення коментаря.
- Відображення та введення CAPTCHA для незареєстрованих користувачів.
- Відображення коментарів.

## Примітка: фронтенд — допоміжна частина, основна логіка реалізована на бекенді.


## Безпека

- Всі паролі хешуються за допомогою bcrypt.

- CAPTCHA захищає від ботів.

- JWT-токени оновлюються кожні 15 хвилин.

- CORS дозволений лише для довірених доменів.

- Prisma захищає від SQL-ін’єкцій через параметризовані запити.

## Контакти:
Автор: Septor
Email: savinov.stas2001@gmail.com
GitHub: https://github.com/Septors







