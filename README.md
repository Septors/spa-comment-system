# SPA Comment System (Backend)

**Backend-часть системы комментариев** с аутентификацией, RBAC, очередями и кешированием.

---

##  Особенности

### **1. Ядро системы**
- **Аутентификация**: JWT + refresh-токены.
- **RBAC**: Роли USER/GUEST. Гости требуют CAPTCHA.
- **Файлы**: Загрузка изображений/текста + автоматический ресайз через очереди.

### **2. Оптимизации**
- **Кеширование**: Redis (LIFO-список последних комментариев + фильтры).
- **Фоновая обработка**: BullMQ для ресайза изображений.
- **Валидация**: 
  - MIME-типы файлов.
  - XHTML-теги в комментариях (разрешены `<a>`, `<code>`, `<i>`, `<strong>`).

### **3. Технологии**
- **Node.js** (Express)
- **Prisma** (PostgreSQL)
- **Redis** (кеш + очереди)
- **BullMQ** (очереди задач)
- **JWT**  (токены безопасности)
- **multer** (получение и филтрация файлов)
- **sharp** (изменение размера файла)
- **websocket** (реактивная связь между клиентом и сервером) 

---

##  Запуск

### 1. **Требования**
- Docker + Docker Compose
- Node.js v18+

### 2. **Инструкция**
# 1. Клонировать репозиторий
git clone https://github.com/Septors/spa-comment-system
cd spa-comment-system

# 2. Установить зависимости и запустить сервер
npm install
npm start

# 3. Запустить сервисы
docker-compose up -d -build

# 4. Запуск APi:
- frontend: http://localhost:3000/
- для проверки в postman: http://localhost:5000/


##  API Documentation
Полная спецификация API доступна в файле:[swagger.yaml](./swagger.yaml)

## Важные детали
# Для гостей:
- Требуется CAPTCHA.
- Создаётся временный аккаунт с рандомным email (например, guest_123@temp.com).


 # Для пользователей:
- Регистрация/логин с валидацией.
- JWT-токены с черным списком (Redis).

# Работа с файлами
- Изображения: Ресайз при превышении MAX_WIDTH/HEIGHT.

- Тексты: Проверка на XSS и валидные теги.

- Frontend (демо)
Минимальный интерфейс для тестирования API:
- Создание пользователя
- создание комментария 
- предпросмотр файла при выборе во время создания коментария
- отображение и ввод капчи в случае не зарегестрированого пользователя
- отображение самого коментария (возможно,я не до конца смог разобраться как подключить получение фильрованных данных)

## Примечание: Frontend — вспомогательная часть. Основная логика реализована на backend.


## Безопасность

- Все пароли хешируются (bcrypt).

- CAPTCHA защищает от ботов.

- JWT-токены обновляются каждые 15 минут.

- CORS* Разрешены только trusted домены

- SQL-инъекции: Защита через Prisma Parameterized Queries

## Будущие улучшение

- реализация полного цикла работы с коментариями(изменение,удаление)  
- добавление личного профиля пользователя  
- добавление системы оценки коментариев
- полная реализация websocket на каждое основное события которое уже реализовано или будет реализовано
- реализация фронтенд части проекта человеком который его знает,а не мной(ну или ai)



## Контакты:
Автор: Septor

### Проект разработан в ходе выполнения технического задания на позицию junior+ backend(node.js) deweloper 
